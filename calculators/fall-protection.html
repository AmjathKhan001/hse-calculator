<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fall Protection Calculator | HSE Calculator</title>
    <meta name="description" content="Calculate fall protection requirements, clearance distances, and anchor point strengths for working at height safety.">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/utilities.css">
    <link rel="stylesheet" href="../css/calculator.css">
    <link rel="stylesheet" href="../css/responsive.css">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DRRTSHLC01"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DRRTSHLC01');
    </script>
    
    <!-- HTML2PDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="../index.html" class="logo">
                    <img src="../assets/logo.png" alt="HSE Calculator Logo" class="logo-img">
                    <span>HSE Calculator</span>
                </a>
                
                <div class="nav-links" id="navLinks">
                    <a href="../index.html" class="nav-link"><i class="fas fa-home"></i> Home</a>
                    <a href="risk-assessment.html" class="nav-link active"><i class="fas fa-calculator"></i> Calculators</a>
                    <a href="../pages/products.html" class="nav-link"><i class="fas fa-shopping-bag"></i> Safety Products</a>
                    <a href="../pages/tools.html" class="nav-link"><i class="fas fa-tools"></i> Tools</a>
                    <a href="../pages/blog.html" class="nav-link"><i class="fas fa-blog"></i> Blog</a>
                    <a href="../index.html#contact" class="nav-link"><i class="fas fa-envelope"></i> Contact</a>
                </div>
                
                <div class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </div>
            </nav>
        </div>
    </header>

    <!-- Calculator Content -->
    <section class="calculator-section">
        <div class="container">
            <h1 class="section-title">Fall Protection Calculator</h1>
            <p class="section-subtitle">Calculate fall clearance distances, anchor requirements, and system compatibility for working at height.</p>
            
            <div class="calculator-form" id="fall-calculator-form">
                <div class="form-group">
                    <label for="work-height" class="form-label">Working Height:</label>
                    <div class="input-group">
                        <input type="number" id="work-height" class="form-control" min="1" max="1000" step="0.1" value="6">
                        <span class="input-group-text">meters</span>
                    </div>
                    <small class="form-text">Height from working surface to ground/next level</small>
                </div>
                
                <div class="form-group">
                    <label for="fall-arrest-system" class="form-label">Fall Arrest System Type:</label>
                    <select id="fall-arrest-system" class="form-control">
                        <option value="full-body-harness">Full Body Harness</option>
                        <option value="lanyard">Lanyard with Shock Absorber</option>
                        <option value="self-retracting">Self-Retracting Lifeline</option>
                        <option value="rope-grab">Rope Grab Device</option>
                        <option value="positioning">Positioning System</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="lanyard-length" class="form-label">Lanyard/Lifeline Length:</label>
                        <div class="input-group">
                            <input type="number" id="lanyard-length" class="form-control" min="0.5" max="30" step="0.1" value="2">
                            <span class="input-group-text">meters</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="deceleration-distance" class="form-label">Deceleration Distance:</label>
                        <div class="input-group">
                            <input type="number" id="deceleration-distance" class="form-control" min="0.5" max="5" step="0.1" value="1.8">
                            <span class="input-group-text">meters</span>
                        </div>
                        <small class="form-text">Shock absorber deployment + harness stretch</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="anchor-height" class="form-label">Anchor Point Height:</label>
                        <div class="input-group">
                            <input type="number" id="anchor-height" class="form-control" min="0" max="50" step="0.1" value="2">
                            <span class="input-group-text">meters</span>
                        </div>
                        <small class="form-text">Height above working surface</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="worker-height" class="form-label">Worker Height:</label>
                        <div class="input-group">
                            <input type="number" id="worker-height" class="form-control" min="1" max="2.5" step="0.01" value="1.8">
                            <span class="input-group-text">meters</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="worker-weight" class="form-label">Worker Weight (with tools):</label>
                    <div class="input-group">
                        <input type="number" id="worker-weight" class="form-control" min="40" max="200" step="1" value="100">
                        <span class="input-group-text">kg</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="anchor-strength" class="form-label">Anchor Point Strength:</label>
                    <select id="anchor-strength" class="form-control">
                        <option value="5000">5,000 lbf (22.2 kN) - OSHA Minimum</option>
                        <option value="2250">2,250 lbf (10 kN) - Temporary Anchor</option>
                        <option value="10000">10,000 lbf (44.5 kN) - Permanent Anchor</option>
                        <option value="custom">Custom Strength</option>
                    </select>
                </div>
                
                <div class="form-group" id="custom-anchor-group" style="display: none;">
                    <label for="custom-anchor-strength" class="form-label">Custom Anchor Strength:</label>
                    <div class="input-group">
                        <input type="number" id="custom-anchor-strength" class="form-control" min="1000" step="100" placeholder="Enter strength in lbf">
                        <span class="input-group-text">lbf</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hazards Below:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hazard-obstacles" checked>
                            <span class="checkbox-text">Obstacles/Equipment</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="hazard-traffic">
                            <span class="checkbox-text">Vehicle Traffic</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="hazard-water">
                            <span class="checkbox-text">Water Hazards</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="hazard-electrical">
                            <span class="checkbox-text">Electrical Hazards</span>
                        </label>
                    </div>
                </div>
                
                <button id="calculate-fall" class="btn btn-primary btn-lg">
                    <i class="fas fa-hard-hat"></i> Calculate Fall Protection
                </button>
                <button id="reset-fall" class="btn btn-secondary btn-lg">
                    <i class="fas fa-redo"></i> Reset
                </button>
                
                <div id="fall-result" class="result-box" style="display: none;">
                    <h3><i class="fas fa-shield-alt"></i> Fall Protection Analysis</h3>
                    
                    <div class="result-summary">
                        <div class="summary-card" id="clearance-card">
                            <div class="summary-icon">
                                <i class="fas fa-ruler-vertical"></i>
                            </div>
                            <div class="summary-content">
                                <h5>Required Clearance</h5>
                                <div class="summary-value" id="required-clearance">0 m</div>
                            </div>
                        </div>
                        
                        <div class="summary-card" id="safety-card">
                            <div class="summary-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="summary-content">
                                <h5>Safety Margin</h5>
                                <div class="summary-value" id="safety-margin">0 m</div>
                            </div>
                        </div>
                        
                        <div class="summary-card" id="force-card">
                            <div class="summary-icon">
                                <i class="fas fa-weight-hanging"></i>
                            </div>
                            <div class="summary-content">
                                <h5>Arrest Force</h5>
                                <div class="summary-value" id="arrest-force">0 kN</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="clearance-diagram mt-4">
                        <h5><i class="fas fa-project-diagram"></i> Clearance Diagram</h5>
                        <div class="diagram-container" id="fall-diagram"></div>
                    </div>
                    
                    <div class="calculation-details mt-4">
                        <h5><i class="fas fa-calculator"></i> Calculation Details</h5>
                        <div class="details-table" id="fall-details"></div>
                    </div>
                    
                    <div class="recommendations mt-4">
                        <h5><i class="fas fa-lightbulb"></i> Safety Recommendations</h5>
                        <div id="fall-recommendations"></div>
                    </div>
                    
                    <div class="print-actions mt-4">
                        <button class="btn btn-primary print-btn" onclick="generatePDF('fall-calculator-form', 'fall-protection')">
                            <i class="fas fa-file-pdf"></i> Save as PDF Report
                        </button>
                        <button class="btn btn-secondary" onclick="window.print()">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                </div>
                
                <div class="calculator-info mt-4">
                    <h4><i class="fas fa-info-circle"></i> Fall Protection Standards</h4>
                    
                    <div class="standards-table">
                        <h5>Regulatory Requirements</h5>
                        <table class="risk-matrix">
                            <thead>
                                <tr>
                                    <th>Standard</th>
                                    <th>Free Fall Limit</th>
                                    <th>Arrest Force Limit</th>
                                    <th>Clearance Safety Factor</th>
                                    <th>Anchor Strength</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>OSHA 1926.502</td>
                                    <td>1.8 m (6 ft)</td>
                                    <td>8 kN (1,800 lbf)</td>
                                    <td>2.1 m (7 ft)</td>
                                    <td>22.2 kN (5,000 lbf)</td>
                                </tr>
                                <tr>
                                    <td>ANSI Z359</td>
                                    <td>1.8 m (6 ft)</td>
                                    <td>8 kN (1,800 lbf)</td>
                                    <td>1.8 m (6 ft)</td>
                                    <td>22.2 kN (5,000 lbf)</td>
                                </tr>
                                <tr>
                                    <td>CSA Z259</td>
                                    <td>1.2 m (4 ft)</td>
                                    <td>6 kN (1,350 lbf)</td>
                                    <td>1.5 m (5 ft)</td>
                                    <td>22.2 kN (5,000 lbf)</td>
                                </tr>
                                <tr>
                                    <td>EN 795</td>
                                    <td>2.0 m (6.6 ft)</td>
                                    <td>6 kN (1,350 lbf)</td>
                                    <td>1.0 m (3.3 ft)</td>
                                    <td>12 kN (2,700 lbf)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="hierarchy-fall-protection mt-4">
                        <h5><i class="fas fa-sitemap"></i> Hierarchy of Fall Protection</h5>
                        <div class="hierarchy-steps">
                            <div class="hierarchy-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h6>Elimination</h6>
                                    <p>Work from ground level using extended tools</p>
                                </div>
                            </div>
                            <div class="hierarchy-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h6>Passive Protection</h6>
                                    <p>Guardrails, safety nets, hole covers</p>
                                </div>
                            </div>
                            <div class="hierarchy-step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h6>Work Positioning</h6>
                                    <p>Restraint systems that prevent falls</p>
                                </div>
                            </div>
                            <div class="hierarchy-step">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h6>Fall Arrest</h6>
                                    <p>Systems that stop a fall in progress</p>
                                </div>
                            </div>
                            <div class="hierarchy-step">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <h6>Administrative Controls</h6>
                                    <p>Training, procedures, supervision</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Social Sharing -->
            <div class="social-sharing mt-4">
                <div class="social-card">
                    <h3><i class="fas fa-share-alt"></i> Share This Calculator</h3>
                    <p>Help other safety professionals discover this tool</p>
                    <div class="social-buttons">
                        <a href="#" class="social-btn facebook" onclick="shareCalculator('Fall Protection Calculator').facebook()">
                            <i class="fab fa-facebook-f"></i> Facebook
                        </a>
                        <a href="#" class="social-btn twitter" onclick="shareCalculator('Fall Protection Calculator').twitter()">
                            <i class="fab fa-twitter"></i> Twitter
                        </a>
                        <a href="#" class="social-btn linkedin" onclick="shareCalculator('Fall Protection Calculator').linkedin()">
                            <i class="fab fa-linkedin-in"></i> LinkedIn
                        </a>
                        <a href="#" class="social-btn whatsapp" onclick="shareCalculator('Fall Protection Calculator').whatsapp()">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Related Calculators -->
            <div class="related-calculators mt-4">
                <h3 class="section-title"><i class="fas fa-calculator"></i> Related Calculators</h3>
                <div class="calculators-grid">
                    <div class="calculator-card">
                        <div class="calculator-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="calculator-content">
                            <h3>Risk Assessment Calculator</h3>
                            <p>Calculate risk levels based on probability and severity to prioritize safety measures.</p>
                            <a href="risk-assessment.html" class="btn btn-primary btn-small">
                                <i class="fas fa-play-circle"></i> Use Calculator
                            </a>
                        </div>
                    </div>
                    
                    <div class="calculator-card">
                        <div class="calculator-icon">
                            <i class="fas fa-cubes"></i>
                        </div>
                        <div class="calculator-content">
                            <h3>Lifting Safety Calculator</h3>
                            <p>Calculate safe lifting limits and manual handling risks.</p>
                            <a href="lifting-safety.html" class="btn btn-primary btn-small">
                                <i class="fas fa-play-circle"></i> Use Calculator
                            </a>
                        </div>
                    </div>
                    
                    <div class="calculator-card">
                        <div class="calculator-icon">
                            <i class="fas fa-hard-hat"></i>
                        </div>
                        <div class="calculator-content">
                            <h3>PPE Selection Calculator</h3>
                            <p>Select appropriate personal protective equipment for various hazards.</p>
                            <a href="ppe-selection.html" class="btn btn-primary btn-small">
                                <i class="fas fa-play-circle"></i> Use Calculator
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <a href="../index.html" class="footer-logo">
                        <img src="../assets/logo.png" alt="HSE Calculator Logo" class="logo-img">
                        <span>HSE Calculator</span>
                    </a>
                    <p>Professional tools for health, safety, and environment professionals.</p>
                    <div class="footer-social">
                        <a href="https://www.facebook.com/Amjathkhan.s" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="https://x.com/amjikhan" target="_blank"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.instagram.com/amjathkhan_official/" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.linkedin.com/in/amjathkhan-shiekusman/" target="_blank"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="risk-assessment.html">Calculators</a></li>
                        <li><a href="../pages/products.html">Safety Products</a></li>
                        <li><a href="../pages/tools.html">Tools</a></li>
                        <li><a href="../pages/blog.html">Blog</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="../pages/privacy.html">Privacy Policy</a></li>
                        <li><a href="../pages/terms.html">Terms of Use</a></li>
                        <li><a href="../pages/affiliate-disclosure.html">Affiliate Disclosure</a></li>
                        <li><a href="../pages/sitemap.html">Sitemap</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4>Contact Us</h4>
                    <ul class="contact-info">
                        <li><i class="fas fa-envelope"></i> <a href="mailto:contact@amjathkhan.com">contact@amjathkhan.com</a></li>
                        <li><i class="fas fa-phone"></i> <a href="tel:+919750816163">+91-9750816163</a></li>
                        <li><i class="fas fa-globe"></i> <a href="https://www.amjathkhan.com/" target="_blank">www.amjathkhan.com</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 HSE Calculator. All rights reserved.</p>
                <p>Professional tools for workplace safety and compliance</p>
                <p class="disclaimer"><small><i class="fas fa-exclamation-triangle"></i> Disclaimer: This calculator provides estimates only. Always consult with qualified professionals for fall protection systems.</small></p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../js/main.js"></script>
    <script src="../js/calculators.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Show/hide custom anchor strength
            document.getElementById('anchor-strength').addEventListener('change', function() {
                const customGroup = document.getElementById('custom-anchor-group');
                customGroup.style.display = this.value === 'custom' ? 'block' : 'none';
            });
            
            // Calculate button
            document.getElementById('calculate-fall').addEventListener('click', calculateFallProtection);
            document.getElementById('reset-fall').addEventListener('click', resetFallForm);
        });

        function calculateFallProtection() {
            // Get input values
            const workHeight = parseFloat(document.getElementById('work-height').value);
            const systemType = document.getElementById('fall-arrest-system').value;
            const lanyardLength = parseFloat(document.getElementById('lanyard-length').value);
            const decelerationDistance = parseFloat(document.getElementById('deceleration-distance').value);
            const anchorHeight = parseFloat(document.getElementById('anchor-height').value);
            const workerHeight = parseFloat(document.getElementById('worker-height').value);
            const workerWeight = parseFloat(document.getElementById('worker-weight').value);
            const anchorStrength = getAnchorStrength();
            
            // Get hazard checkboxes
            const hasObstacles = document.getElementById('hazard-obstacles').checked;
            const hasTraffic = document.getElementById('hazard-traffic').checked;
            const hasWater = document.getElementById('hazard-water').checked;
            const hasElectrical = document.getElementById('hazard-electrical').checked;
            
            // Calculate fall clearance
            const clearance = calculateFallClearance(
                workHeight, systemType, lanyardLength, 
                decelerationDistance, anchorHeight, workerHeight
            );
            
            // Calculate arresting force
            const arrestingForce = calculateArrestingForce(
                workerWeight, lanyardLength, systemType
            );
            
            // Check anchor adequacy
            const anchorAdequate = checkAnchorAdequacy(arrestingForce, anchorStrength);
            
            // Calculate safety margin
            const safetyMargin = workHeight - clearance.totalClearance;
            
            // Assess risks
            const riskAssessment = assessFallRisks(
                clearance, safetyMargin, anchorAdequate,
                hasObstacles, hasTraffic, hasWater, hasElectrical
            );
            
            // Display results
            displayFallResults({
                workHeight,
                systemType,
                lanyardLength,
                decelerationDistance,
                anchorHeight,
                workerHeight,
                workerWeight,
                anchorStrength,
                clearance,
                arrestingForce,
                anchorAdequate,
                safetyMargin,
                riskAssessment
            });
            
            // Show result section
            document.getElementById('fall-result').style.display = 'block';
        }

        function getAnchorStrength() {
            const anchorSelect = document.getElementById('anchor-strength');
            if (anchorSelect.value === 'custom') {
                return parseFloat(document.getElementById('custom-anchor-strength').value);
            }
            return parseFloat(anchorSelect.value);
        }

        function calculateFallClearance(workHeight, systemType, lanyardLength, decelerationDistance, anchorHeight, workerHeight) {
            // Free fall distance based on system type
            let freeFallDistance = lanyardLength;
            
            // Adjust for system type
            switch(systemType) {
                case 'self-retracting':
                    freeFallDistance = Math.min(lanyardLength, 0.6); // SRLs typically limit to 0.6m
                    break;
                case 'rope-grab':
                    freeFallDistance = 0.3; // Rope grabs limit free fall
                    break;
                case 'positioning':
                    freeFallDistance = 0; // Positioning systems prevent falls
                    break;
            }
            
            // Calculate total clearance required
            const totalClearance = 
                anchorHeight + // Anchor point above work surface
                freeFallDistance + // Free fall before arrest
                decelerationDistance + // Shock absorber deployment
                workerHeight + // Worker height
                1.0; // Safety factor (1 meter minimum)
            
            // Calculate swing fall radius if anchor is not directly above
            const swingFallRadius = Math.sqrt(Math.pow(anchorHeight, 2) + Math.pow(lanyardLength, 2));
            
            return {
                freeFallDistance: freeFallDistance,
                totalClearance: totalClearance,
                swingFallRadius: swingFallRadius,
                isAdequate: totalClearance < workHeight
            };
        }

        function calculateArrestingForce(workerWeight, lanyardLength, systemType) {
            // Convert weight to mass (kg to N)
            const weightN = workerWeight * 9.81; // Weight in Newtons
            
            // Calculate fall factor (f = h/L)
            const fallFactor = lanyardLength > 0 ? (lanyardLength / lanyardLength) : 1; // Simplified
            
            // Maximum arresting force based on standards
            let maxForce;
            switch(systemType) {
                case 'full-body-harness':
                    maxForce = 8000; // 8 kN OSHA limit
                    break;
                case 'lanyard':
                    maxForce = 6000; // 6 kN with shock absorber
                    break;
                case 'self-retracting':
                    maxForce = 4000; // 4 kN typical for SRL
                    break;
                case 'rope-grab':
                    maxForce = 6000; // 6 kN
                    break;
                case 'positioning':
                    maxForce = 3000; // 3 kN for positioning
                    break;
                default:
                    maxForce = 6000;
            }
            
            // Calculate actual force (simplified)
            const force = Math.min(weightN * fallFactor * 3, maxForce); // 3g deceleration
            
            return {
                forceN: force,
                forcekN: force / 1000,
                forcelbf: force * 0.2248,
                isWithinLimit: force <= maxForce
            };
        }

        function checkAnchorAdequacy(arrestingForce, anchorStrength) {
            // Convert anchor strength from lbf to N if needed
            const anchorStrengthN = anchorStrength * 4.44822; // lbf to N
            
            const safetyFactor = 2.0; // Required safety factor
            const requiredStrength = arrestingForce.forceN * safetyFactor;
            
            return {
                anchorStrengthN: anchorStrengthN,
                requiredStrength: requiredStrength,
                safetyFactor: anchorStrengthN / arrestingForce.forceN,
                isAdequate: anchorStrengthN >= requiredStrength
            };
        }

        function assessFallRisks(clearance, safetyMargin, anchorAdequate, hasObstacles, hasTraffic, hasWater, hasElectrical) {
            let riskLevel = 'Low';
            let colorClass = 'status-low';
            let recommendations = [];
            
            // Check clearance adequacy
            if (safetyMargin < 0) {
                riskLevel = 'Extreme';
                colorClass = 'status-extreme';
                recommendations.push('INSUFFICIENT CLEARANCE - Fall would result in impact');
                recommendations.push('Reduce working height or increase anchor height');
                recommendations.push('Consider alternative fall protection methods');
            } else if (safetyMargin < 1.0) {
                riskLevel = 'High';
                colorClass = 'status-high';
                recommendations.push('Marginal clearance - Increase safety margin');
                recommendations.push('Use shorter lanyard or higher anchor point');
            } else if (safetyMargin < 2.0) {
                riskLevel = 'Moderate';
                colorClass = 'status-moderate';
                recommendations.push('Adequate clearance - Maintain current setup');
            } else {
                riskLevel = 'Low';
                colorClass = 'status-low';
                recommendations.push('Good clearance margin - System is adequate');
            }
            
            // Check anchor adequacy
            if (!anchorAdequate.isAdequate) {
                riskLevel = 'Very High';
                colorClass = 'status-very-high';
                recommendations.push('ANCHOR POINT INADEQUATE - Upgrade required');
                recommendations.push(`Required strength: ${(anchorAdequate.requiredStrength/1000).toFixed(1)} kN`);
                recommendations.push(`Current strength: ${(anchorAdequate.anchorStrengthN/1000).toFixed(1)} kN`);
            }
            
            // Check swing fall hazard
            if (clearance.swingFallRadius > clearance.totalClearance * 0.5) {
                recommendations.push('Potential swing fall hazard - Position anchor directly above work area');
            }
            
            // Check hazards below
            if (hasObstacles) {
                recommendations.push('Clear obstacles from fall zone');
                recommendations.push('Use warning signs or barriers');
            }
            
            if (hasTraffic) {
                riskLevel = riskLevel === 'Low' ? 'Moderate' : riskLevel;
                recommendations.push('Implement traffic control measures');
                recommendations.push('Use spotters for traffic awareness');
            }
            
            if (hasWater) {
                recommendations.push('Provide water rescue equipment');
                recommendations.push('Ensure workers can swim or wear PFDs');
            }
            
            if (hasElectrical) {
                riskLevel = riskLevel === 'Low' ? 'High' : 'Very High';
                recommendations.push('USE NON-CONDUCTIVE FALL PROTECTION EQUIPMENT');
                recommendations.push('Maintain safe distance from electrical sources');
                recommendations.push('De-energize equipment if possible');
            }
            
            // Add general recommendations
            recommendations.push('Inspect all equipment before each use');
            recommendations.push('Provide fall protection training');
            recommendations.push('Develop rescue plan for fallen worker');
            recommendations.push('Conduct regular equipment inspections');
            
            return {
                riskLevel: riskLevel,
                colorClass: colorClass,
                recommendations: recommendations
            };
        }

        function displayFallResults(data) {
            // Update summary cards
            document.getElementById('required-clearance').textContent = 
                `${data.clearance.totalClearance.toFixed(1)} m`;
            document.getElementById('safety-margin').textContent = 
                `${data.safetyMargin.toFixed(1)} m`;
            document.getElementById('arrest-force').textContent = 
                `${data.arrestingForce.forcekN.toFixed(1)} kN`;
            
            // Update card colors
            const safetyColor = data.safetyMargin < 1.0 ? 'status-high' : 
                              data.safetyMargin < 2.0 ? 'status-moderate' : 'status-low';
            
            document.getElementById('clearance-card').className = `summary-card ${safetyColor}`;
            document.getElementById('safety-card').className = `summary-card ${safetyColor}`;
            document.getElementById('force-card').className = `summary-card ${data.arrestingForce.isWithinLimit ? 'status-low' : 'status-high'}`;
            
            // Create clearance diagram
            const diagramHtml = `
                <div class="diagram">
                    <div class="diagram-scale">
                        <div class="scale-label">Ground Level</div>
                        <div class="scale-line" style="height: ${data.workHeight * 10}px">
                            <div class="work-surface" style="bottom: 0">
                                <span>Work Surface</span>
                            </div>
                            <div class="anchor-point" style="bottom: ${data.anchorHeight * 10}px">
                                <span>Anchor Point</span>
                            </div>
                            <div class="fall-clearance" style="height: ${data.clearance.totalClearance * 10}px; bottom: 0">
                                <span>Required Clearance: ${data.clearance.totalClearance.toFixed(1)}m</span>
                            </div>
                            <div class="safety-margin" style="height: ${Math.max(data.safetyMargin, 0) * 10}px; bottom: ${data.clearance.totalClearance * 10}px">
                                <span>Safety Margin: ${data.safetyMargin.toFixed(1)}m</span>
                            </div>
                        </div>
                        <div class="scale-label">Working Height: ${data.workHeight.toFixed(1)}m</div>
                    </div>
                    <div class="diagram-legend">
                        <div class="legend-item">
                            <span class="legend-color work-surface"></span>
                            <span>Work Surface</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color anchor-point"></span>
                            <span>Anchor Point</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color fall-clearance"></span>
                            <span>Required Clearance</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color safety-margin"></span>
                            <span>Safety Margin</span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('fall-diagram').innerHTML = diagramHtml;
            
            // Display calculation details
            const detailsHtml = `
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Working Height</td>
                            <td>${data.workHeight.toFixed(1)} m</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Lanyard Length</td>
                            <td>${data.lanyardLength.toFixed(1)} m</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Free Fall Distance</td>
                            <td>${data.clearance.freeFallDistance.toFixed(1)} m</td>
                            <td>${data.clearance.freeFallDistance <= 1.8 ? '✓ Within Limit' : '⚠ Exceeds 1.8m'}</td>
                        </tr>
                        <tr>
                            <td>Deceleration Distance</td>
                            <td>${data.decelerationDistance.toFixed(1)} m</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Total Clearance Required</td>
                            <td>${data.clearance.totalClearance.toFixed(1)} m</td>
                            <td>${data.clearance.isAdequate ? '✓ Adequate' : '✗ Insufficient'}</td>
                        </tr>
                        <tr>
                            <td>Arresting Force</td>
                            <td>${data.arrestingForce.forcekN.toFixed(1)} kN</td>
                            <td>${data.arrestingForce.isWithinLimit ? '✓ Within Limit' : '⚠ Exceeds limit'}</td>
                        </tr>
                        <tr>
                            <td>Anchor Point Strength</td>
                            <td>${(data.anchorAdequate.anchorStrengthN/1000).toFixed(1)} kN</td>
                            <td>${data.anchorAdequate.isAdequate ? '✓ Adequate' : '✗ Insufficient'}</td>
                        </tr>
                        <tr>
                            <td>Anchor Safety Factor</td>
                            <td>${data.anchorAdequate.safetyFactor.toFixed(1)}</td>
                            <td>${data.anchorAdequate.safetyFactor >= 2.0 ? '✓ Meets 2:1' : '✗ Below 2:1'}</td>
                        </tr>
                        <tr>
                            <td>Swing Fall Radius</td>
                            <td>${data.clearance.swingFallRadius.toFixed(1)} m</td>
                            <td>${data.clearance.swingFallRadius > data.clearance.totalClearance * 0.5 ? '⚠ Potential hazard' : '✓ Acceptable'}</td>
                        </tr>
                        <tr>
                            <td>Overall Risk Level</td>
                            <td><strong>${data.riskAssessment.riskLevel}</strong></td>
                            <td><span class="status-${data.riskAssessment.colorClass}">${data.safetyMargin >= 0 ? 'System may work' : 'System will fail'}</span></td>
                        </tr>
                    </tbody>
                </table>
            `;
            document.getElementById('fall-details').innerHTML = detailsHtml;
            
            // Display recommendations
            const recList = document.getElementById('fall-recommendations');
            recList.innerHTML = '';
            
            data.riskAssessment.recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'recommendation-item';
                const isCritical = rec.includes('INSUFFICIENT') || rec.includes('INADEQUATE') || rec.includes('USE NON-CONDUCTIVE');
                div.innerHTML = `
                    <i class="fas ${isCritical ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                    <span>${rec}</span>
                `;
                recList.appendChild(div);
            });
        }

        function resetFallForm() {
            document.getElementById('work-height').value = '6';
            document.getElementById('fall-arrest-system').value = 'full-body-harness';
            document.getElementById('lanyard-length').value = '2';
            document.getElementById('deceleration-distance').value = '1.8';
            document.getElementById('anchor-height').value = '2';
            document.getElementById('worker-height').value = '1.8';
            document.getElementById('worker-weight').value = '100';
            document.getElementById('anchor-strength').value = '5000';
            document.getElementById('custom-anchor-group').style.display = 'none';
            document.getElementById('hazard-obstacles').checked = true;
            document.getElementById('hazard-traffic').checked = false;
            document.getElementById('hazard-water').checked = false;
            document.getElementById('hazard-electrical').checked = false;
            document.getElementById('fall-result').style.display = 'none';
        }

        function generatePDF(elementId, filename) {
            const element = document.getElementById(elementId);
            
            const opt = {
                margin: 0.5,
                filename: `${filename}-${new Date().getTime()}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save();
        }

        function shareCalculator(title) {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(`${title} - Professional HSE Tool`);
            
            return {
                facebook: () => window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank'),
                twitter: () => window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank'),
                linkedin: () => window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank'),
                whatsapp: () => window.open(`https://api.whatsapp.com/send?text=${text}: ${url}`, '_blank')
            };
        }
    </script>
</body>
</html>
